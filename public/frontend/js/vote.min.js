window.voteMode=2,window.vote=function(e,t){var o=document.getElementById("selected-nominee");o&&(o.value=e);try{document.querySelectorAll(".per-category .inside-col").forEach(function(e){e.classList.remove("selected")});var n=document.getElementById(""+e);if(n){var r=n.closest(".inside-col");r&&r.classList.add("selected")}}catch(e){}if(23===t)FingerprintJS.load().then(e=>e.get()).then(t=>{const o=t.visitorId;fetch("/vote/verify",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({fingerprint:o,nominee:e})}).then(e=>e.text()).then(t=>{try{const r=JSON.parse(t);if("exists"==r.status){var o=document.querySelector(".per-nominee");if(nomineeName=document.getElementById(""+e).querySelector("h4").innerText,!o)return;if(1===window.voteMode){var n=document.querySelector(".per-category");n&&(n.style.display="none"),o.style.display="block",o.scrollIntoView({behavior:"smooth"})}else o.style.display="block",document.querySelector(".label-text-inner").innerText=nomineeName,o.scrollIntoView({behavior:"smooth"})}else"verified"==r.status&&Swal.fire({title:"",html:"You have successfully voted for "+r.name+"!",icon:"success",confirmButtonText:"Close",customClass:{confirmButton:"swal-custom-button",popup:"swal-custom-popup",icon:"swal-custom-icon",htmlContainer:"swal-message-center"}})}catch(e){console.error("Not JSON:",t)}})});else{var s=document.querySelector(".per-nominee");if(nomineeName=document.getElementById(""+e).querySelector("h4").innerText,!s)return;if(1===window.voteMode){var c=document.querySelector(".per-category");c&&(c.style.display="none"),s.style.display="block",s.scrollIntoView({behavior:"smooth"})}else s.style.display="block",document.querySelector(".label-text-inner").innerText=nomineeName,s.scrollIntoView({behavior:"smooth"})}},document.addEventListener("DOMContentLoaded",function(){function e(e,t){const o=document.querySelector(".loader-content"),n=document.querySelector(".loader-content h6");t?(n.textContent=e,o.style.display="flex"):o.style.display="none"}async function t(t){try{const n=await fetch(`/vote/verify-mobile/${t.nominee}/${t.payment_number}`,{method:"GET",headers:{Accept:"application/json"}});if(!n.ok)throw e("",!1),new Error("Network response was not ok");const r=await n.json();"error"===r.status?(e("",!1),notyf.error(r.message)):o(t)}catch(t){e("",!1),console.error("Error fetching:",t)}}function o(t){try{e("Enter PIN to complete MWK "+t.price+".",!0),fetch("/vote/process-payment",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t._token},body:JSON.stringify(t)}).then(e=>e.json()).then(o=>{if(null===o.error)if(o.response&&"success"===o.response.status)n(t,o.response.data.charge_id);else if(o.response&&"failed"===o.response.status){if(e("",!1),o.response&&o.response.message){const e=o.response.message;if("string"==typeof e)notyf.error(e);else if("object"==typeof e){const t=Object.keys(e)[0],o=e[t];Array.isArray(o)?notyf.error(o[0]):notyf.error(o)}else console.log("Unexpected message format:",e),notyf.error("Unexpected error response!")}}else e("",!1),notyf.error("Unexpected response structure!");else{const e=o.error,t=Object.keys(e)[0],n=e[t];notyf.error(n)}}).catch(e=>{if(e.errors){let t=Object.values(e.errors).flat().join("\\n");alert("Validation errors:\\n"+t)}else alert("Submission failed: "+(e.message||e))})}catch(e){console.error("Error fetching:",e)}}async function n(t,o){try{e("Finalizing transaction...",!0),t.charge_id=o;const r=await fetch("/vote/check-status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t._token},body:JSON.stringify(t)});if(!r.ok)throw new Error("Network response was not ok");const s=await r.json();s.response&&"success"===s.response.data.status?(e("",!1),Swal.fire({title:"",html:"You have successfully voted for "+s.name+"!",icon:"success",confirmButtonText:"Close",customClass:{confirmButton:"swal-custom-button",popup:"swal-custom-popup",icon:"swal-custom-icon",htmlContainer:"swal-message-center"}})):s.response&&"failed"===s.response.data.status?(e("",!1),notyf.error("Payment failed. Please try again.")):n(t,o)}catch(e){return console.error("Error checking status:",e),{error:e.message}}}var r=document.getElementById("payment-method"),s=document.querySelector(".payment"),c=document.getElementById("price"),a=s.querySelector("input"),i=document.querySelector(".per-nominee");i.addEventListener("submit",function(o){o.preventDefault();var n=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),s={payment_method:r.value,price:c.value,payment_number:a.value,nominee:document.querySelector("#selected-nominee").value,_token:n};e("Processing payment, please wait...",!0),t(s)})});