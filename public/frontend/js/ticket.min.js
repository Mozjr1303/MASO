document.addEventListener("DOMContentLoaded",function(){function e(e,t){const o=document.querySelector(".loader-content"),n=document.querySelector(".loader-content h6");t?(n.textContent=e,o.style.display="flex"):o.style.display="none"}async function t(o,n){try{e("Finalizing transaction...",!0),o.charge_id=n;const r=await fetch("/api/verify-ticket-payment",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o._token},body:JSON.stringify(o)});if(!r.ok)throw new Error("Network response was not ok");const s=await r.json();console.log("Status response:",s),s.response&&"success"===s.response.data.status?(e("",!1),notyf.success("Payment successful! Generating your ticket..."),s.refresh&&setTimeout(()=>{window.location.reload()},2e3)):s.response&&"failed"===s.response.data.status?(e("",!1),notyf.error("Payment failed. Please try again.")):t(o,n)}catch(e){return console.error("Error checking status:",e),{error:e.message}}}var o=document.getElementById("ticketForm");o.addEventListener("submit",function(o){o.preventDefault();var n=document.getElementById("name"),r=document.getElementById("mobile"),s=document.getElementById("ticket_type"),a=document.getElementById("email"),c=document.getElementById("code"),i=document.getElementById("payment-method"),l=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),d={name:n.value,mobile:r.value,ticketType:s.value,email:a.value,paymentMethod:i.value,code:c.value,_token:l};e("Processing payment, please wait...",!0),fetch("/api/process-ticket-payment",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d._token},body:JSON.stringify(d)}).then(e=>e.json()).then(o=>{if(console.log(o),null===o.error)if(o.response&&"success"===o.response.status)t(d,o.response.data.charge_id);else if(o.response&&"failed"===o.response.status){if(e("",!1),o.response&&o.response.message){const e=o.response.message;if("string"==typeof e)notyf.error(e);else if("object"==typeof e){const t=Object.keys(e)[0],o=e[t];Array.isArray(o)?notyf.error(o[0]):notyf.error(o)}else console.log("Unexpected message format:",e),notyf.error("Unexpected error response!")}}else"error"===o.status?(e("",!1),notyf.error(o.message)):(e("",!1),notyf.error("Unexpected response structure!"));else{const e=o.error,t=Object.keys(e)[0],n=e[t];notyf.error(n)}}).catch(t=>{console.error("Error:",t),notyf.error("An error occurred while processing your request."),e("",!1)})})});